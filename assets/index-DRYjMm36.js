import{j as $,r as C,w as A,f as g,k as d,l as c,p as e,q as D,s as O,v as M,u as _,F as S,x as k,y as N,z as b,A as F,B as z,C as B,a as R,D as x,E as U,G as j}from"./vue-vendor-CRQup0x_.js";import{d as q,c as G}from"./pinia-vendor-NXFdRE1g.js";import{u as H,i as W,L as K,a as X,b as Y,c as J,d as Q,e as Z}from"./echarts-vendor-CD-CH3lg.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();const ee={class:"filter-bar"},te={class:"filter-bar__left"},se={class:"filter-bar__inputs"},ne={class:"filter-bar__date-range"},oe={class:"filter-bar__control"},re={class:"filter-bar__control"},ie=["disabled"],ae={key:0},le={key:1},de={key:0,class:"filter-bar__warning"},ce={class:"filter-bar__status"},ue={key:0},_e={key:1},me=$({__name:"FilterBar",props:{start:{},end:{},loading:{type:Boolean},generatedAt:{}},emits:["update:start","update:end","submit"],setup(n,{emit:s}){const t=n,r=s,o=C(y(t.start)),i=C(y(t.end||t.start)),a=C("");A(()=>t.start,v=>{o.value=y(v)}),A(()=>t.end,v=>{i.value=y(v||t.start)}),A([o,i],([v,m])=>{const h=p(v,"start"),I=p(m,"end");h&&h!==t.start&&r("update:start",h),I&&I!==t.end&&r("update:end",I)});const l=g(()=>o.value!==""&&i.value!=="");function f(){if(!l.value){a.value="请选择开始日期和结束日期。";return}const v=new Date(o.value),m=new Date(i.value);if(v>m){a.value="开始日期不能晚于结束日期。";return}a.value="",r("submit")}const u=g(()=>{if(!t.generatedAt)return"";const v=new Date(t.generatedAt);return Number.isNaN(v.getTime())?"":`上次更新：${v.toLocaleString("zh-CN",{hour12:!1})}`});function y(v){if(!v)return"";const m=new Date(v);if(Number.isNaN(m.getTime()))return"";const h=V=>String(V).padStart(2,"0"),I=m.getFullYear(),P=h(m.getMonth()+1),T=h(m.getDate());return`${I}-${P}-${T}`}function p(v,m="start"){if(!v)return"";const h=new Date(v);return Number.isNaN(h.getTime())?"":(m==="start"?h.setHours(0,0,0,0):h.setHours(23,59,59,999),h.toISOString())}return(v,m)=>(c(),d("section",ee,[e("div",te,[m[4]||(m[4]=e("div",{class:"filter-bar__titles"},[e("h1",null,"客诉分析雷达"),e("p",{class:"filter-bar__subtitle"}," 洞察所选时间段内客户情绪与投诉紧急度的变化趋势。 ")],-1)),e("div",se,[e("div",ne,[e("label",oe,[m[2]||(m[2]=e("span",null,"开始日期",-1)),O(e("input",{"onUpdate:modelValue":m[0]||(m[0]=h=>o.value=h),type:"date",max:"9999-12-31"},null,512),[[M,o.value]])]),e("label",re,[m[3]||(m[3]=e("span",null,"结束日期",-1)),O(e("input",{"onUpdate:modelValue":m[1]||(m[1]=h=>i.value=h),type:"date",max:"9999-12-31"},null,512),[[M,i.value]])])]),e("button",{type:"button",disabled:n.loading,onClick:f},[n.loading?(c(),d("span",ae,"洞察更新中...")):(c(),d("span",le,"生成洞察"))],8,ie)]),a.value?(c(),d("p",de,_(a.value),1)):D("",!0)]),e("div",ce,[u.value?(c(),d("p",ue,_(u.value),1)):(c(),d("p",_e,"选择时间范围以开始分析。"))])]))}}),w=(n,s)=>{const t=n.__vccOpts||n;for(const[r,o]of s)t[r]=o;return t},pe=w(me,[["__scopeId","data-v-5b8cbbcd"]]),ve={class:"category-list"},fe={key:0,class:"category-list__items"},ye=["onClick"],he={class:"category-list__item-header"},ge={class:"category-list__item-name"},be={class:"category-list__item-volume"},$e={class:"category-list__sentiment"},we={class:"category-list__sentiment-label"},xe={class:"category-list__sentiment-score"},Se={class:"category-list__meta"},ke={key:1,class:"category-list__empty"},Ie=$({__name:"CategoryList",props:{categories:{},selectedId:{}},emits:["select"],setup(n,{emit:s}){const t=n,r=s,o=g(()=>t.categories.length>0);function i(l){return l>=.25?"var(--sentiment-positive)":l<=-.25?"var(--sentiment-negative)":"var(--sentiment-neutral)"}function a(l){return l>=.5?"强烈正向":l>=.1?"略偏正向":l<=-.5?"强烈负向":l<=-.1?"略偏负向":"情绪混合"}return(l,f)=>(c(),d("aside",ve,[f[1]||(f[1]=e("h2",null,"投诉类别",-1)),f[2]||(f[2]=e("p",{class:"category-list__hint"}," 依情绪强度与反馈量排序，帮助快速锁定优先处理议题。 ",-1)),o.value?(c(),d("div",fe,[(c(!0),d(S,null,k(n.categories,u=>(c(),d("button",{key:u.id,type:"button",class:N(["category-list__item",{"category-list__item--active":u.id===n.selectedId}]),onClick:y=>r("select",u.id)},[e("div",he,[e("span",ge,_(u.name),1),e("span",be,_(u.volume)+" 条反馈",1)]),e("div",$e,[e("span",{class:"category-list__pill",style:b({backgroundColor:i(u.emotionIndex)})},null,4),e("span",we,_(a(u.emotionIndex)),1),e("span",xe,_(u.emotionIndex>0?"+":"")+_((u.emotionIndex*100).toFixed(0)),1)]),e("div",Se,[e("span",null,"优先度 "+_((u.priorityScore*100).toFixed(0))+"%",1),e("span",null,"紧急度 "+_(Math.round(u.urgency*100))+"%",1)])],10,ye))),128))])):(c(),d("div",ke,[...f[0]||(f[0]=[e("p",null,"当前时间段内暂无可供分析的类别。",-1)])]))]))}}),Ce=w(Ie,[["__scopeId","data-v-76f095e4"]]),Ae={class:"emotion-overview"},De={class:"emotion-overview__content"},Le={class:"emotion-card__header"},Oe={class:"emotion-card__name"},Me={class:"emotion-card__score"},Ne={class:"emotion-card__value"},Fe={class:"emotion-bar"},Ee={class:"emotion-card__stats"},Pe=$({__name:"EmotionOverview",props:{categories:{}},setup(n){function s(o){return o<=-.7?"#ef4444":o<-.3?"#f97316":o<.3?"#6b7280":o<.7?"#3b82f6":"#10b981"}function t(o){return o<=-.7?"强烈负向":o<-.3?"显著负向":o<.3?"接近中性":o<.7?"明显正向":"强烈正向"}function r(o){return o.toFixed(2)}return(o,i)=>(c(),d("section",Ae,[i[1]||(i[1]=e("div",{class:"emotion-overview__header"},[e("h3",null,"用户情绪分析"),e("p",null,"各类型问题的用户情绪强度得分（加权平均）")],-1)),e("div",De,[(c(!0),d(S,null,k(n.categories,a=>(c(),d("div",{key:a.id,class:"emotion-card"},[e("div",Le,[e("h4",Oe,_(a.name),1),e("div",Me,[e("span",Ne,_(r(a.emotionIndex)),1),e("span",{class:"emotion-card__label",style:b({color:s(a.emotionIndex)})},_(t(a.emotionIndex)),5)])]),e("div",Fe,[e("div",{class:"emotion-bar__fill",style:b({width:`${Math.abs(a.emotionIndex)*100}%`,backgroundColor:s(a.emotionIndex),transform:a.emotionIndex<0?"translateX(100%)":"none"})},null,4),i[0]||(i[0]=e("div",{class:"emotion-bar__center"},null,-1))]),e("div",Ee,[e("span",null,"投诉数量："+_(a.volume),1)])]))),128))])]))}}),Te=w(Pe,[["__scopeId","data-v-c00b71f9"]]),Ve={class:"priority-overview"},ze={class:"priority-overview__content"},Be={class:"priority-card__header"},Re={class:"priority-card__name"},Ue={class:"priority-card__score"},je={class:"priority-card__value"},qe={class:"priority-breakdown"},Ge={class:"priority-breakdown__item"},He={class:"priority-breakdown__bar"},We={class:"priority-breakdown__right"},Ke={class:"priority-breakdown__value"},Xe={class:"priority-breakdown__item"},Ye={class:"priority-breakdown__bar"},Je={class:"priority-breakdown__value"},Qe={class:"priority-card__stats"},Ze=$({__name:"PriorityOverview",props:{categories:{}},setup(n){function s(i){return i>=.8?"#ef4444":i>=.6?"#f97316":i>=.4?"#eab308":"#6b7280"}function t(i){return i>=.8?"紧急高风险":i>=.6?"优先跟进":i>=.4?"重点留意":"低度关注"}function r(i){return i.toFixed(2)}function o(i){return i>=3.4?{level:"非常紧急",color:"#ef4444"}:i>=2.5?{level:"很紧急",color:"#f97316"}:i>=1.5?{level:"紧急",color:"#eab308"}:{level:"不太紧急",color:"#6b7280"}}return(i,a)=>(c(),d("section",Ve,[a[2]||(a[2]=e("div",{class:"priority-overview__header"},[e("h3",null,"问题优先级分析"),e("p",null,"各类型问题的优先级得分（紧急度60% + 重要度40%）")],-1)),e("div",ze,[(c(!0),d(S,null,k(n.categories,l=>(c(),d("div",{key:l.id,class:"priority-card"},[e("div",Be,[e("h4",Re,_(l.name),1),e("div",Ue,[e("span",je,_(r(l.priorityScore)),1),e("span",{class:"priority-card__label",style:b({color:s(l.priorityScore)})},_(t(l.priorityScore)),5)])]),e("div",qe,[e("div",Ge,[a[0]||(a[0]=e("span",{class:"priority-breakdown__label"},"紧急度",-1)),e("div",He,[e("div",{class:"priority-breakdown__fill",style:b({width:`${l.urgency*100}%`,backgroundColor:"#ef4444"})},null,4)]),e("div",We,[e("span",Ke,_((l.urgency*100).toFixed(0))+"%",1),e("span",{class:"priority-breakdown__level",style:b({color:o(l.urgency*5).color})},_(o(l.urgency*5).level),5)])]),e("div",Xe,[a[1]||(a[1]=e("span",{class:"priority-breakdown__label"},"重要度",-1)),e("div",Ye,[e("div",{class:"priority-breakdown__fill",style:b({width:`${l.importance*100}%`,backgroundColor:"#3b82f6"})},null,4)]),e("span",Je,_((l.importance*100).toFixed(0))+"%",1)])]),e("div",Qe,[e("span",null,"投诉数量："+_(l.volume),1)])]))),128))])]))}}),et=w(Ze,[["__scopeId","data-v-e9cf8dd6"]]),tt={class:"volume"},st=$({__name:"CategoryVolumeChart",props:{categories:{}},setup(n){H([X,Y,J,Q,Z]);const s=n,t=C(null);let r=null;const o=g(()=>{const f=s.categories.map(y=>y.name),u=s.categories.map(y=>y.volume);return{labels:f,volumes:u}});function i(){t.value&&(r=W(t.value),a())}function a(){if(!r)return;const{labels:f,volumes:u}=o.value;r.setOption({backgroundColor:"#ffffff",grid:{left:60,right:40,top:40,bottom:60},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter(y){const[p]=y,v=(p==null?void 0:p.data)??0;return`
          <div>
            <strong>${(p==null?void 0:p.axisValueLabel)??""}</strong><br/>
            数量：${v}
          </div>
        `}},xAxis:{type:"category",data:f,axisLabel:{interval:0,rotate:f.length>5?20:0},axisTick:{alignWithLabel:!0}},yAxis:[{type:"value",name:"数量",axisLabel:{color:"#4b5563"},splitLine:{lineStyle:{color:"#e5e7eb"}}}],series:[{name:"数量",type:"bar",barWidth:24,itemStyle:{borderRadius:[8,8,0,0],color:new K(0,0,0,1,[{offset:0,color:"#2563eb"},{offset:1,color:"#60a5fa"}])},data:u}]})}function l(){r==null||r.resize()}return F(()=>{i(),window.addEventListener("resize",l)}),z(()=>{window.removeEventListener("resize",l),r==null||r.dispose(),r=null}),A(o,()=>{a()}),(f,u)=>(c(),d("section",tt,[u[0]||(u[0]=e("header",{class:"volume__header"},[e("div",null,[e("h3",null,"投诉量与优先度趋势"),e("p",null,"对比投诉量与优先度指数，及时捕捉异常波动。")])],-1)),e("div",{ref_key:"chartRef",ref:t,class:"volume__chart"},null,512)]))}}),nt=w(st,[["__scopeId","data-v-31156789"]]),ot={key:0,class:"summary"},rt={class:"summary__header"},it={class:"summary__overall"},at={class:"summary__score"},lt={class:"summary__grid"},dt={class:"summary__block"},ct={class:"summary__block summary__block--alert"},ut={class:"summary__block"},_t={key:1,class:"summary summary--empty"},mt=$({__name:"SummaryCard",props:{summary:{}},setup(n){return(s,t)=>n.summary?(c(),d("section",ot,[e("header",rt,[t[0]||(t[0]=e("h3",null,"洞察总览",-1)),e("p",it,[B(" 整体情绪："+_(n.summary.overallSentimentLabel)+" ",1),e("span",at,"指数 "+_(n.summary.overallSentimentScore>0?"+":"")+_(n.summary.overallSentimentScore.toFixed(2)),1)])]),e("div",lt,[e("div",dt,[t[1]||(t[1]=e("h4",null,"积极亮点",-1)),e("ul",null,[(c(!0),d(S,null,k(n.summary.highlights,r=>(c(),d("li",{key:r},_(r),1))),128))])]),e("div",ct,[t[2]||(t[2]=e("h4",null,"风险警报",-1)),e("ul",null,[(c(!0),d(S,null,k(n.summary.alerts,r=>(c(),d("li",{key:r},_(r),1))),128))])]),e("div",ut,[t[3]||(t[3]=e("h4",null,"执行建议",-1)),e("ul",null,[(c(!0),d(S,null,k(n.summary.recommendedNextSteps,r=>(c(),d("li",{key:r},_(r),1))),128))])])])])):(c(),d("section",_t,[...t[4]||(t[4]=[e("p",null,"生成洞察后将在此展示摘要引导。",-1)])]))}}),pt=w(mt,[["__scopeId","data-v-56840133"]]);function vt(n){return Object.entries(n).map(([s,t],r)=>({id:`category_${r}`,name:s,emotionIndex:t.emotional/5*-1,emotions:[{label:"情绪强度",score:Math.min(1,Math.max(0,t.emotional/5)),tone:t.emotional>2.5?"negative":"neutral"},{label:"重要程度",score:Math.min(1,Math.max(0,t.severity/5)),tone:"neutral"},{label:"紧急程度",score:Math.min(1,Math.max(0,t.urgency/5)),tone:t.urgency>2.5?"negative":"neutral"}],urgency:Math.min(1,Math.max(0,t.urgency/5)),importance:Math.min(1,Math.max(0,t.severity/5)),priorityScore:Math.min(1,Math.max(0,(t.urgency*.6+t.severity*.4)/5)),volume:t.count,topUtterances:[`${s}类投诉共${t.count}条`],recommendedAction:`建议关注${s}类型投诉的处理优先级`}))}async function ft(n){try{const s=new Date(n.start).toISOString().split("T")[0],t=n.end?new Date(n.end).toISOString().split("T")[0]:s,r=`/api/getAnalysisData?startDate=${s}&endDate=${t}`,o=await fetch(r);if(!o.ok)throw new Error(`API请求失败: ${o.status}`);const i=await o.json();if(i.code!==0)throw new Error("API返回错误码");const a=vt(i.data),l=a.reduce((y,p)=>y+p.volume,0),f=a.reduce((y,p)=>y+p.emotionIndex*p.volume,0),u=l>0?f/l:0;return{generatedAt:new Date().toISOString(),timeRange:{start:n.start,end:n.end},categories:a,summary:{highlights:[`共分析${l}条投诉数据`,`整体情感得分为${u.toFixed(2)}`],alerts:a.filter(y=>y.urgency>.7).map(y=>`${y.name}类型投诉紧急程度较高`),recommendedNextSteps:["根据优先级排序处理投诉类型","重点关注高紧急程度和高情绪强度的投诉"],overallSentimentLabel:`整体情感${u>0?"积极":u<-.2?"消极":"中性"}`,overallSentimentScore:u}}}catch(s){throw console.error("API调用失败:",s),s}}const L=new Date().toISOString(),yt=q("analysis",{state:()=>({loading:!1,error:null,selectedCategoryId:null,analysis:null}),getters:{categories(n){var s;return((s=n.analysis)==null?void 0:s.categories)??[]},selectedCategory(){const n=this.categories,s=n[0]??null;return s?this.selectedCategoryId?n.find(t=>t.id===this.selectedCategoryId)??s:s:null},summaryText(n){var s;return((s=n.analysis)==null?void 0:s.summary)??null},startDate(n){var s,t;return((t=(s=n.analysis)==null?void 0:s.timeRange)==null?void 0:t.start)??L},generatedAt(n){var s;return((s=n.analysis)==null?void 0:s.generatedAt)??null}},actions:{setSelectedCategory(n){this.selectedCategoryId=n},async loadAnalysis(n){var s;this.loading=!0,this.error=null;try{const t=(n==null?void 0:n.start)??L,r=(n==null?void 0:n.end)??L,o=await ft({start:t,end:r});this.analysis=o,this.selectedCategoryId=((s=o.categories[0])==null?void 0:s.id)??null}catch(t){const r=t instanceof Error?t.message:"Failed to load analysis.";this.error=r}finally{this.loading=!1}}}}),ht={class:"app-shell"},gt={class:"app-shell__header"},bt={key:0,class:"app-shell__overlay"},$t={key:1,class:"app-shell__error"},wt={key:2,class:"app-shell__grid"},xt={class:"app-shell__grid-content"},St={class:"app-shell__grid-top"},kt={class:"app-shell__grid-bottom"},It={key:3,class:"app-shell__empty"},Ct={class:"app-shell__footer"},At=$({__name:"App",setup(n){const s=yt(),t=R({start:new Date().toISOString(),end:new Date().toISOString()}),r=g(()=>s.categories),o=g(()=>s.selectedCategory),i=g(()=>s.summaryText),a=g(()=>s.loading),l=g(()=>s.generatedAt),f=g(()=>s.error);function u(){s.loadAnalysis({start:t.start,end:t.end})}return F(()=>{s.analysis||s.loadAnalysis({start:t.start,end:t.end})}),(y,p)=>{var v;return c(),d("div",ht,[e("header",gt,[x(pe,{start:t.start,end:t.end,loading:a.value,"generated-at":l.value,"onUpdate:start":p[0]||(p[0]=m=>t.start=m),"onUpdate:end":p[1]||(p[1]=m=>t.end=m),onSubmit:u},null,8,["start","end","loading","generated-at"])]),e("main",{class:N(["app-shell__main",{"app-shell__main--loading":a.value}])},[a.value?(c(),d("div",bt,[...p[2]||(p[2]=[e("div",{class:"app-shell__spinner"},null,-1),e("p",null,"正在生成最新洞察…",-1)])])):D("",!0),f.value?(c(),d("div",$t,[e("p",null,_(f.value),1),e("button",{type:"button",onClick:u},"重试")])):D("",!0),r.value.length?(c(),d("section",wt,[x(Ce,{class:"app-shell__grid-sidebar",categories:r.value,"selected-id":((v=o.value)==null?void 0:v.id)??null,onSelect:U(s).setSelectedCategory},null,8,["categories","selected-id","onSelect"]),e("div",xt,[e("section",St,[x(Te,{categories:r.value},null,8,["categories"]),x(et,{categories:r.value},null,8,["categories"])]),e("section",kt,[x(nt,{categories:r.value},null,8,["categories"])])])])):!a.value&&!f.value?(c(),d("div",It,[...p[3]||(p[3]=[e("p",null,"请选择时间范围以查看客诉洞察分析。",-1)])])):D("",!0)],2),e("footer",Ct,[x(pt,{summary:i.value},null,8,["summary"])])])}}}),Dt=w(At,[["__scopeId","data-v-02e2b45b"]]),E=j(Dt);E.use(G());E.mount("#app");
